// ------------------------ FGB ----------------------

@PART[Alniyat_Crew_2_1,Alniyat_Crew_2_2]:NEEDS[TACLS]
{
	// 6 days supplies for 2 crew (1.5T mass)
	RESOURCE
    {
        name = Food
        amount = 0.3656
        maxAmount = 0.3656
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 6
        @maxAmount *= 6
    }
    RESOURCE
    {
        name = Water
        amount = 0.2416
        maxAmount = 0.2416
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 6
        @maxAmount *= 6
    }
    RESOURCE
    {
        name = Oxygen
        amount = 37.0126
        maxAmount = 37.0126
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 6
        @maxAmount *= 6
    }
    RESOURCE
    {
        name = CarbonDioxide
        amount = 0
        maxAmount = 31.971
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 6
    }
    RESOURCE
    {
        name = Waste
        amount = 0
        maxAmount = 0.1
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 6
    }
    RESOURCE
    {
        name = WasteWater
        amount = 0
        maxAmount = 0.308
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 6
    }
}

@PART[Alniyat_Crew_3_1,Alniyat_Crew_3_2]:NEEDS[TACLS]
{
	// 3 days supplies for 2 crew (1.125T mass)
	RESOURCE
    {
        name = Food
        amount = 0.3656
        maxAmount = 0.3656
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Water
        amount = 0.2416
        maxAmount = 0.2416
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Oxygen
        amount = 37.0126
        maxAmount = 37.0126
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = CarbonDioxide
        amount = 0
        maxAmount = 31.971
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Waste
        amount = 0
        maxAmount = 0.1
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = WasteWater
        amount = 0
        maxAmount = 0.308
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
}

// Alniyat_Habitation_1 - Airlock
@PART[Alniyat_Habitation_1]:NEEDS[TACLS]
{
	// 6 hours/1 Day for 1 kerbal (for refilling packs on way out or emergency use)
	RESOURCE
    {
        name = Food
        amount = 0.3656
        maxAmount = 0.3656
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 1
        @maxAmount *= 1
    }
    RESOURCE
    {
        name = Water
        amount = 0.2416
        maxAmount = 0.2416
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 1
        @maxAmount *= 1
    }
    RESOURCE
    {
        name = Oxygen
        amount = 37.0126
        maxAmount = 37.0126
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 1
        @maxAmount *= 1
    }
}

@PART[Alniyat_Habitation_2_1,Alniyat_Habitation_2_2]:NEEDS[TACLS]
{
	// 3 days supplies for 1 crew (0.75T mass)
	RESOURCE
    {
        name = Food
        amount = 0.3656
        maxAmount = 0.3656
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Water
        amount = 0.2416
        maxAmount = 0.2416
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Oxygen
        amount = 37.0126
        maxAmount = 37.0126
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = CarbonDioxide
        amount = 0
        maxAmount = 31.971
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Waste
        amount = 0
        maxAmount = 0.1
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = WasteWater
        amount = 0
        maxAmount = 0.308
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
}


// ------------------------ LK -----------------------

@PART[Libra_Crew_1]:AFTER[TACLS]
{
	// Remove generator, add Fuel Cell with 15 days O2/H @ 8kW (30 days @ 4kW)
	!MODULE[ModuleGenerator] {}

	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = Fuel Cell 8kW
		StartActionName = Start Fuel Cell 8kW
		StopActionName = Stop Fuel Cell 8kW
		AutoShutdown = true
		GeneratesHeat = true
		TemperatureModifier = 10
		UseSpecializationBonus = false
		DefaultShutoffTemp = 0.5
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 0.064736
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.032368
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 8
			DumpExcess = true
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0000520721
			DumpExcess = true
		}
	}
	
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = Fuel Cell 4kW
		StartActionName = Start Fuel Cell 4kW
		StopActionName = Stop Fuel Cell 4kW
		AutoShutdown = true
		GeneratesHeat = true
		TemperatureModifier = 10
		UseSpecializationBonus = false
		DefaultShutoffTemp = 0.5
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 0.064736
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.032368
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 4
			DumpExcess = true
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0000520721
			DumpExcess = true
		}
	}
	
	// Includes about 15 days of resources @ full load (TBC)
	RESOURCE
	{
		name = Hydrogen
		amount = 21000
		maxAmount = 21000
	}
	
	// Part already has Oxygen from the CommandModule, so add on 15 days for the fuelcell
	%RESOURCE
	{
		name = Oxygen
		amount += 10500
		maxAmount += 10500
	}
}

// ------------------------ LK-1 ---------------------

// ------------------------ LOK ----------------------

// ------------------------ MIR ----------------------

@PART[Eridani_Crew_2]:FOR[TACLS]
{
	// 30 days supplies for 5 kerbals
	RESOURCE
    {
        name = Food
        amount = 0.3656
        maxAmount = 0.3656
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 30
        @maxAmount *= 30
    }
    RESOURCE
    {
        name = Water
        amount = 0.2416
        maxAmount = 0.2416
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 30
        @maxAmount *= 30
    }
    RESOURCE
    {
        name = Oxygen
        amount = 37.0126
        maxAmount = 37.0126
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 30
        @maxAmount *= 30
    }
    RESOURCE
    {
        name = CarbonDioxide
        amount = 0
        maxAmount = 31.971
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 30
    }
    RESOURCE
    {
        name = Waste
        amount = 0
        maxAmount = 0.1
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 30
    }
    RESOURCE
    {
        name = WasteWater
        amount = 0
        maxAmount = 0.308
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 30
    }
}

// AFTER so that the patch to add resources is performed during TACLS and this happens after
@PART[Eridani_Crew_2]:AFTER[TACLS]
{
	// Add FuelCell + 30 days O2/H @ 8kW (60 days @ 4kW)
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = Fuel Cell 8kW
		StartActionName = Start Fuel Cell 8kW
		StopActionName = Stop Fuel Cell 8kW
		AutoShutdown = true
		GeneratesHeat = true
		TemperatureModifier = 10
		UseSpecializationBonus = false
		DefaultShutoffTemp = 0.5
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 0.064736
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.032368
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 8
			DumpExcess = true
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0000520721
			DumpExcess = true
		}
	}
	
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = Fuel Cell 4kW
		StartActionName = Start Fuel Cell 4kW
		StopActionName = Stop Fuel Cell 4kW
		AutoShutdown = true
		GeneratesHeat = true
		TemperatureModifier = 10
		UseSpecializationBonus = false
		DefaultShutoffTemp = 0.5
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 0.064736
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.032368
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 4
			DumpExcess = true
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0000520721
			DumpExcess = true
		}
	}
	
	// Includes about 30 days of resources @ full load
	RESOURCE
	{
		name = Hydrogen
		amount = 42000
		maxAmount = 42000
	}
	
	// Part already has Oxygen from another patch, so add on 30 days for the fuelcell
	%RESOURCE
	{
		name = Oxygen
		amount += 21000
		maxAmount += 21000
	}
}

// ------------------------ MIR-37K ------------------

@PART[Acamar_Lab_1,Acamar_Lab_2]:FOR[TACLS]
{
	// 3 days supplies for 1 kerbal
	RESOURCE
    {
        name = Food
        amount = 0.3656
        maxAmount = 0.3656
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Water
        amount = 0.2416
        maxAmount = 0.2416
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Oxygen
        amount = 37.0126
        maxAmount = 37.0126
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = CarbonDioxide
        amount = 0
        maxAmount = 31.971
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Waste
        amount = 0
        maxAmount = 0.1
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = WasteWater
        amount = 0
        maxAmount = 0.308
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
}

@PART[Acamar_Lab_1,Acamar_Lab_2]:AFTER[TACLS]
{
	// Add FuelCell + 15 days O2/H @ 8kW (30 days @ 4kW)
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = Fuel Cell 8kW
		StartActionName = Start Fuel Cell 8kW
		StopActionName = Stop Fuel Cell 8kW
		AutoShutdown = true
		GeneratesHeat = true
		TemperatureModifier = 10
		UseSpecializationBonus = false
		DefaultShutoffTemp = 0.5
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 0.064736
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.032368
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 8
			DumpExcess = true
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0000520721
			DumpExcess = true
		}
	}
	
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = Fuel Cell 4kW
		StartActionName = Start Fuel Cell 4kW
		StopActionName = Stop Fuel Cell 4kW
		AutoShutdown = true
		GeneratesHeat = true
		TemperatureModifier = 10
		UseSpecializationBonus = false
		DefaultShutoffTemp = 0.5
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 0.064736
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.032368
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 4
			DumpExcess = true
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0000520721
			DumpExcess = true
		}
	}
	
	// Includes about 15 days of resources @ full load
	RESOURCE
	{
		name = Hydrogen
		amount = 21000
		maxAmount = 
	}
	
	// Part already has Oxygen from another patch, so add on 15 days for the fuelcell
	%RESOURCE
	{
		name = Oxygen
		amount += 700
		maxAmount += 10500
	}
}

// ------------------------ PIRS ---------------------

// Hadar_Crew_1 has ModuleCommand

// ------------------------ Progress -----------------

// TODO - Make the Progress resupply module work with B9TankSwitch/ConfigurableContainers?
@PART[Hamal_Habitation_1]:NEEDS[TACLS]
{
	// Resupply capsule, maximum of ~6 Months days supplies for 8 kerbals (heavy!)
	// Optional 30 days Hydrogen supply to refill fuel cells
	// + 1000L of KIS storage
	RESOURCE
    {
        name = Food
        amount = 0			// Not full by default
        maxAmount = 0.3656  // 1 day
		@maxAmount *= 8 	// * 8 Kerbals
        @maxAmount *= 180 	// * 180 days
    }
    RESOURCE
    {
        name = Water
        amount = 0
        maxAmount = 0.2416
        @maxAmount *= 8
        @maxAmount *= 180
    }
    RESOURCE
    {
        name = Oxygen
        amount = 0
        maxAmount = 37.0126
        @maxAmount *= 8
        @maxAmount *= 180
    }
    RESOURCE
    {
    	name = Hydrogen
    	amount = 0
    	maxAmount = 42000
    }
}


// ------------------------ Rassvet ------------------

// Mira_Crew_1 has ModuleCommand

// ------------------------ Salyut -------------------

// Vega_Habitation_1 has ModuleCommand

// ------------------------ Soyuz --------------------

// Soyuz_Crew_1 has ModuleCommand
// Soyuz_Crew_2 has ModuleCommand

// T-OM1 Orbital Module & T-OM1B Orbital Module
@PART[Tantares_Habitation_1,Tantares_Orbital_1]:FOR[TACLS]
{
	// 3 days supplies for 1 kerbal
	RESOURCE
    {
        name = Food
        amount = 0.3656
        maxAmount = 0.3656
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Water
        amount = 0.2416
        maxAmount = 0.2416
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Oxygen
        amount = 37.0126
        maxAmount = 37.0126
        @amount *= #$/CrewCapacity$
        @maxAmount *= #$/CrewCapacity$
        @amount *= 3
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = CarbonDioxide
        amount = 0
        maxAmount = 31.971
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = Waste
        amount = 0
        maxAmount = 0.1
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
    RESOURCE
    {
        name = WasteWater
        amount = 0
        maxAmount = 0.308
        @maxAmount *= #$/CrewCapacity$
        @maxAmount *= 3
    }
}

@PART[Tantares_Habitation_1,Tantares_Orbital_1]:AFTER[TACLS]
{
	// Add FuelCell + 15 days O2/H @ 8kW (60 days @ 4kW)
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = Fuel Cell 8kW
		StartActionName = Start Fuel Cell 8kW
		StopActionName = Stop Fuel Cell 8kW
		AutoShutdown = true
		GeneratesHeat = true
		TemperatureModifier = 10
		UseSpecializationBonus = false
		DefaultShutoffTemp = 0.5
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 0.064736
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.032368
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 8
			DumpExcess = true
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0000520721
			DumpExcess = true
		}
	}
	
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = Fuel Cell 4kW
		StartActionName = Start Fuel Cell 4kW
		StopActionName = Stop Fuel Cell 4kW
		AutoShutdown = true
		GeneratesHeat = true
		TemperatureModifier = 10
		UseSpecializationBonus = false
		DefaultShutoffTemp = 0.5
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 0.064736
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.032368
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 4
			DumpExcess = true
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0000520721
			DumpExcess = true
		}
	}
	
	// Includes about 15 days of resources @ full load
	RESOURCE
	{
		name = Hydrogen
		amount = 21000
		maxAmount = 
	}
	
	// Part already has Oxygen from another patch, so add on 15 days for the fuelcell
	%RESOURCE
	{
		name = Oxygen
		amount += 700
		maxAmount += 10500
	}
}

// ------------------------ VA -----------------------

// Alnair has ModuleCommand

// ------------------------ Vostok -------------------

// Andromeda_Crew_1 has ModuleCommand